import numpy as np
from scipy.interpolate import interp1d


Si_index = np.array(
    [
        [380.2498084, 6.433425757],
        [383.7399107, 6.243171494],
        [387.2300131, 6.060527403],
        [389.096812, 5.93935461],
        [391.592641, 5.86266297],
        [396.8277946, 5.664798537],
        [402.9354737, 5.474544275],
        [410.788204, 5.281245944],
        [416.0233575, 5.177747626],
        [423.1117825, 5.035573123],
        [433.4738693, 4.880950976],
        [444.816702, 4.736357737],
        [453.9782207, 4.637425521],
        [464.8847905, 4.538493304],
        [475.7041079, 4.453259395],
        [486.6979303, 4.386289894],
        [497.1682374, 4.32540853],
        [511.1286468, 4.249306826],
        [523.1694999, 4.19146953],
        [534.6868377, 4.150374609],
        [545.1571448, 4.104713586],
        [556.4999775, 4.066662734],
        [566.9702845, 4.036222052],
        [577.4405916, 4.00578137],
        [587.0383731, 3.982950858],
        [596.6361546, 3.960120347],
        [610.596564, 3.929679665],
        [625.7785093, 3.899238983],
        [642.0074852, 3.868798301],
        [652.4777923, 3.85357796],
        [662.9480994, 3.838357619],
        [673.4184065, 3.823137278],
        [683.8887135, 3.807916937],
        [690.8689182, 3.807916937],
        [704.8293277, 3.777476255],
        [713.5545836, 3.777476255],
        [732.9246517, 3.747035573],
        [743.2204536, 3.747035573],
        [753.6907607, 3.731815232],
        [764.1610678, 3.716594891],
        [774.6313748, 3.716594891],
        [780.739054, 3.716594891],
    ]
)

Si_ext = np.array(
    [
        [381.0024475, 0.919467375],
        [381.8714074, 0.849197196],
        [382.2991512, 0.812760806],
        [383.6093273, 0.776324417],
        [385.3472472, 0.69824644],
        [387.954127, 0.609758066],
        [389.2289384, 0.56291128],
        [391.4299668, 0.521269692],
        [395.7747665, 0.446661847],
        [401.5678328, 0.372054002],
        [410.1126055, 0.302651356],
        [419.2366849, 0.245394173],
        [431.8366041, 0.195944787],
        [441.8296434, 0.167316196],
        [459.2088423, 0.136085005],
        [468.188095, 0.132614872],
        [477.4570011, 0.097913549],
        [491.3603602, 0.08403302],
        [502.6568394, 0.073622623],
        [515.6912385, 0.066682358],
        [524.380838, 0.058007028],
        [539.6381579, 0.049261084],
        [557.4013158, 0.042391432],
        [564.3529953, 0.042391432],
        [579.1253144, 0.031981035],
        [589.5528337, 0.031981035],
        [599.980353, 0.031981035],
        [610.4078723, 0.031981035],
        [619.0974717, 0.031981035],
        [633.0008308, 0.021570638],
        [643.4283501, 0.021570638],
        [653.8558694, 0.021570638],
        [664.2833887, 0.021570638],
        [674.710908, 0.021570638],
        [685.1384273, 0.021570638],
        [695.5659466, 0.021570638],
        [705.993466, 0.021570638],
        [716.4209853, 0.021570638],
        [726.8485046, 0.021570638],
        [737.2760239, 0.021570638],
        [747.7035432, 0.021570638],
        [758.1310625, 0.021570638],
        [768.5585818, 0.01636544],
        [777.2481812, 0.012461541],
    ]
)


SiO2_index = np.array(
    [
        [385.6890281, 1.471894322],
        [396.1153768, 1.47064316],
        [406.5417256, 1.469496262],
        [416.9680744, 1.468453627],
        [426.9599919, 1.467515256],
        [436.9519095, 1.466681148],
        [447.3782582, 1.46584704],
        [458.1521519, 1.465033785],
        [470.4031117, 1.464178824],
        [482.1327541, 1.46344898],
        [492.5591028, 1.462823399],
        [504.2887452, 1.462145686],
        [516.539705, 1.461530531],
        [528.1824611, 1.460946656],
        [539.0432411, 1.46047747],
        [549.904021, 1.460008285],
        [560.3303698, 1.459591231],
        [569.5982353, 1.459208931],
        [582.2257022, 1.45873627],
        [594.3897757, 1.458319216],
        [606.3800768, 1.457923015],
        [618.3703779, 1.457526813],
        [628.5360679, 1.457245302],
        [639.2230754, 1.456901233],
        [650.692059, 1.456619721],
        [661.1184078, 1.456306931],
        [672.5873914, 1.456025419],
        [682.4055365, 1.455785613],
        [694.1351788, 1.455472823],
        [705.43039, 1.455212164],
        [716.7256011, 1.454951505],
        [727.1519499, 1.454742978],
        [738.447161, 1.45448232],
        [748.8735098, 1.454273793],
        [759.2998586, 1.454065266],
        [770.5950697, 1.453804607],
        [778.4148313, 1.453648212],
    ]
)


class MaterialIndex:
    def __init__(self, index, ext=None):
        self.index = interp1d(index[:, 0], index[:, 1], kind="linear")
        if ext is None:
            self.ext = lambda x: 0
        else:
            self.ext = interp1d(ext[:, 0], ext[:, 1], kind="linear")

    def __call__(self, wl_nm):
        real = self.index(wl_nm)
        image = self.ext(wl_nm)
        return complex(real=real, imag=image)


class MaterialIndex2:
    def __init__(self, array):
        self.index = interp1d(array[:, 0] * 1000, array[:, 1], kind="linear")
        self.ext = interp1d(array[:, 0] * 1000, array[:, 2], kind="linear")

    def __call__(self, wl_nm):
        real = self.index(wl_nm)
        image = self.ext(wl_nm)
        return complex(real=real, imag=image)


Si_Index = MaterialIndex(index=Si_index, ext=Si_ext)
SiO2_Index = MaterialIndex(index=SiO2_index, ext=None)
# MoS2_Index = MaterialIndex2()
Air_Index = lambda x: 1

MoS2_Index = MaterialIndex2(np.loadtxt("material_data/MoS2.csv"))
MoSe2_Index = MaterialIndex2(np.loadtxt("material_data/MoSe2.csv"))
WS2_Index = MaterialIndex2(np.loadtxt("material_data/WS2.csv"))
WSe2_Index = MaterialIndex2(np.loadtxt("material_data/WSe2.csv"))


MATERIAL_INDEX_DICT = {
    "Si": Si_Index,
    "SiO2": SiO2_Index,
    "Air": Air_Index,
    "MoS2": MoS2_Index,
    "MoSe2": MoSe2_Index,
    "WS2": WS2_Index,
    "WSe2": WSe2_Index,
}